# General modules being frequently used
# Kaifang Liu
# 
import numpy as np
from sys import exit
import numba as nb
import time 

import tools as tl



# @nb.njit(nb.types.Tuple((nb.float64[:], nb.float64[:]))(nb.int64, \
#     nb.float64, nb.float64) )
@nb.njit
def quad_1d(nprecision, a=-1.0, b=1.0):

    weights = np.array([2.0, \
        1.0, 1.0, \
        .8888888888888888,
        .5555555555555556, .5555555555555556, \
        .6521451548625461, .6521451548625461,
        .3478548451374538, .3478548451374538,\
        .5688888888888889,
        .4786286704993665, .4786286704993665,
        .2369268850561891, .2369268850561891,\
        .3607615730481386, .3607615730481386,
        .4679139345726910, .4679139345726910,
        .1713244923791704, .1713244923791704,\
        .4179591836734694,
        .3818300505051189, .3818300505051189,
        .2797053914892766, .2797053914892766,
        .1294849661688697, .1294849661688697,\
        .3626837833783620, .3626837833783620,
        .3137066458778873, .3137066458778873,
        .2223810344533745, .2223810344533745,
        .1012285362903763, .1012285362903763,\
        .3302393550012598,
        .1806481606948574, .1806481606948574,
        .0812743883615744, .0812743883615744,
        .3123470770400029, .3123470770400029,
        .2606106964029354, .2606106964029354,\
        .2955242247147529, .2955242247147529,
        .2692667193099963, .2692667193099963,
        .2190863625159820, .2190863625159820,
        .1494513491505806, .1494513491505806,
        .0666713443086881, .0666713443086881,\
        .2729250867779006,
        .2628045445102467, .2628045445102467,
        .2331937645919905, .2331937645919905,
        .1862902109277343, .1862902109277343,
        .1255803694649046, .1255803694649046,
        .0556685671161737, .0556685671161737,
            ])
    nodes = np.array([0.,
        -.5773502691896257, .5773502691896257,
        0.0, -.7745966692414834, .7745966692414834,\
        -.3399810435848563, .3399810435848563, 
        -.8611363115940526, .8611363115940526,\
        0.,
        -.5384693101056831,  .5384693101056831, 
        -.9061798459386640,  .9061798459386640,\
        -.6612093864662645, .6612093864662645, 
        -.2386191860831969,  .2386191860831969,
        -.9324695142031521,  .9324695142031521,\
        0.,
        -.4058451513773972,  .4058451513773972, 
        -.7415311855993945,  .7415311855993945,
        -.9491079123427585,  .9491079123427585,\
        -.1834346424956498, .1834346424956498, 
        -.5255324099163290,  .5255324099163290,
        -.7966664774136267,  .7966664774136267,
        -.9602898564975363,  .9602898564975363,\
        0.,
        -.8360311073266358,  .8360311073266358,
        -.9681602395076261,  .9681602395076261,
        -.3242534234038089,  .3242534234038089,
        -.6133714327005904,  .6133714327005904,\
        -.1488743389816312, .1488743389816312, 
        -.4333953941292472,  .4333953941292472,
        -.6794095682990244,  .6794095682990244,
        -.8650633666889845,  .8650633666889845,
        -.9739065285171717,  .9739065285171717,\
        0.,
        -.2695431559523450,  .2695431559523450,
        -.5190961292068118,  .5190961292068118,
        -.7301520055740494,  .7301520055740494,
        -.8870625997680953,  .8870625997680953,
        -.9782286581460570,  .9782286581460570,
        ])
    
    if nprecision < 1:
        nprecision = 1

    if nprecision > 21:
        raise Exception('QUADS/quad_1d: Precision should not exceed 21.')

    ind = np.array([0, 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, 66], dtype=np.int64)
    # Transform from the reference interval to a general one
    r = .5*(b-a)
    weights = r*weights
    nodes = a+r*(nodes+1)

    degree = np.int64(np.floor((nprecision+2.0)/2.0))

    return weights[ind[degree-1]:ind[degree]], nodes[ind[degree-1]:ind[degree]]


# @nb.njit(nb.types.Tuple((nb.float64[:], nb.float64[:]))(nb.int64, \
#     nb.float64, nb.float64) )
@nb.njit
def quad_1d_Gauss_Lobatto(k=1, a=-1.0, b=1.0):
    '''
        k - if k=1, return 2 points, if k=2, return 3 points, ...
    '''
    weights = np.array([1.0, 1.0,   # n=2
        .3333333333333333333333, 1.333333333333333333333,   # n=3
        .3333333333333333333333,
        .1666666666666666666667, .8333333333333333333333,   # n=4
        .8333333333333333333333, .1666666666666666666667,
        .1,                                                 # n=5
        .544444444444444444444,  .7111111111111111111111, 
        .544444444444444444444,  .1,                     
        .0666666666666666666667, .3784749562978469803166,   # n=6
        .5548583770354863530167, .5548583770354863530167,
        .3784749562978469803166, .0666666666666666666667,
        .0476190476190476190476, .276826047361565948011,    # n=7
        .4317453812098626234179, .487619047619047619048,
        .431745381209862623418,  .2768260473615659480107, 
        .04761904761904761904762,   
        .03571428571428571428571, .210704227143506039383,   # n=8
        .3411226924835043647642,  .4124587946587038815671,
        .412458794658703881567,   .341122692483504364764,
        .210704227143506039383,   .03571428571428571428571,
        .02777777777777777777778, .1654953615608055250463,  # n=9
        .274538712500161735281,   .3464285109730463451151,
        .3715192743764172335601,  .3464285109730463451151,
        .2745387125001617352807,  .165495361560805525046,
        .02777777777777777777778,
        .02222222222222222222222,   .1333059908510701111262,  # n=10
        .2248893420631264521195,    .2920426836796837578756,
        .3275397611838974566565,    .3275397611838974566565,
        .292042683679683757876,      .224889342063126452119,
        .133305990851070111126,     .02222222222222222222222,
        .01818181818181818181818,   .1096122732669948644614, # n=11
        .187169881780305204108,     .2480481042640283140401,
        .2868791247790080886792,    .3002175954556906937859,
        .286879124779008088679,     .2480481042640283140401,
        .1871698817803052041081,    .109612273266994864461,
        .01818181818181818181818,
        .01515151515151515151515,   .091684517413196130668, # n=12
        .1579747055643701151647,    .212508417761021145358,
        .2512756031992012802932,    .2714052409106961770003,
        .2714052409106961770003,    .251275603199201280293,
        .212508417761021145358,     .1579747055643701151647,
        .0916845174131961306683,    .01515151515151515151515,
        ], dtype=np.float64)
    
    nodes = np.array([-1., 1.,  # n=2
        -1., 0., 1.,            # n=3
        -1.,                    -.447213595499957939282,    # n=4
        .447213595499957939282, 1.,    
        -1,                     -.654653670707977143798,    # n=5
        0.,                      .654653670707977143798, 
        1.,
        -1.,                    -.765055323929464692851,    # n=6
        -.2852315164806450963142,  .2852315164806450963142,
        .765055323929464692851,  1.,
        -1.,                        -.830223896278566929872,    # n=7
        -.4688487934707142138038,   0.,
        .468848793470714213804,     .830223896278566929872,
        1.,
        -1.,                        -.8717401485096066153375,   # n=8
        -.5917001814331423021445,   -.2092992179024788687687,
        .2092992179024788687687,    .5917001814331423021445,
        .8717401485096066153375,    1.,
        -1.,                     -.8997579954114601573124,  # n=9
        -.6771862795107377534459, -.3631174638261781587108,
        0.,                        .3631174638261781587108,
        .6771862795107377534459,   .8997579954114601573124,
        1.,
        -1.,                        -.9195339081664588138289, # n=10
        -.7387738651055050750031,   -.4779249498104444956612,
        -.1652789576663870246262,   .1652789576663870246262,
        .4779249498104444956612,    .7387738651055050750031,
        .9195339081664588138289,    1.,
        -1.0,                       -.9340014304080591343323,  # n=11
        -.7844834736631444186224,   -.565235326996205006471,
        -.2957581355869393914319,   0.,
        .2957581355869393914319,    .565235326996205006471,
        .7844834736631444186224,    .9340014304080591343323,
        1.,
        -1.,                        -.9448992722228822234076,  # n=12
        -.8192793216440066783486,   -0.6328761530318606776624,
        -.3995309409653489322643,   -.1365529328549275548641,
        .1365529328549275548641,    .3995309409653489322643,
        .6328761530318606776624,    .8192793216440066783486,
        .9448992722228822234076,    1.,
        ], dtype=np.float64)

    if k < 1:
        k = 1

    if k > 12:
        raise Exception('QUADS/quad_1d_Gauss_Lobatto: Precision should not exceed 12.')

    ind = np.array([0,  2,  5,  9, 14, 20, 27, 35, 44, 54, 65, 77], dtype=np.int64)
    # Transform from the reference interval to a general one
    r = .5*(b-a)
    weights = r*weights
    nodes = a+r*(nodes+1)

    return weights[ind[k-1]:ind[k]], nodes[ind[k-1]:ind[k]]
        




@nb.njit(nb.types.Tuple((nb.float64[:], nb.float64[:,:]))(nb.int64, nb.float64))
def quad_triangle(nprecision, area=1.0):
    '''
    Purpose: return weights and barycentric points on any triangle with 
        area (default area=1)
    Parameter:
        nprecision -  (i, int64, 1 by 1) precision order
        area - (i, float64, 1 by 1) area of the triangle
    References:
        [1] Zhang, L., Cui, T., & Liu, H. (2009). A set of symmetric quadrature 
            rules on triangles and tetrahedra. JCM, 27(1), 89â€“96.
        [2] L.B. Zhang, Parallel Hierarchical Grid (PHG), src/quad.c
    '''
    # Order:  1 2 3 4 5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21
    # points: 1 3 6 6 7 12 15 16 19 25 28 33 37 46 52 55 61 72 73 88 91
    weights = np.array([1.0, #1-1
        .3333333333333333, .3333333333333333, .3333333333333333, #2-3
        .2811498024409796, .2811498024409796, .2811498024409796, #3-6
        .0521835308923537, .0521835308923537, .0521835308923537,
        .2233815896780115, .2233815896780115, .2233815896780115, #4-6
        .1099517436553219, .1099517436553219, .1099517436553219,
        .225,     #5-7
        .1259391805448272, .1259391805448272, .1259391805448272,
        .1323941527885062, .1323941527885062, .1323941527885062,
        .0508449063702068, .0508449063702068, .0508449063702068,#6-12
        .1167862757263794, .1167862757263794, .1167862757263794,
        .0828510756183736, .0828510756183736, .0828510756183736,
        .0828510756183736, .0828510756183736, .0828510756183736,
        .0135338625156656, .0135338625156656, .0135338625156656, #7-15
        .0789512544320109, .0789512544320109, .0789512544320109,
        .1286079278189061, .1286079278189061, .1286079278189061,
        .0561201442833754, .0561201442833754, .0561201442833754,
        .0561201442833754, .0561201442833754, .0561201442833754,
        .1443156076777872, #8-16
        .10321737053471825, .10321737053471825, .10321737053471825,
        .03245849762319808, .03245849762319808, .03245849762319808,
        .09509163426728462, .09509163426728462, .09509163426728462,
        .02723031417443499, .02723031417443499, .02723031417443499,
        .02723031417443499, .02723031417443499, .02723031417443499,
        .09713579628279883, #9-19
        .031334700227139070536, .031334700227139070536, .031334700227139070536,
        .025577675658698031261, .025577675658698031261, .025577675658698031261,
        .077827541004774279316, .077827541004774279316, .077827541004774279316,
        .079647738927210253032, .079647738927210253032, .079647738927210253032,
        .043283539377289377289, .043283539377289377289, .043283539377289377289,
        .043283539377289377289, .043283539377289377289, .043283539377289377289,
        .080937428797622880257, #10-25
        .07729858800296311727, .07729858800296311727, .07729858800296311727,
        .07845763861237173287, .07845763861237173287, .07845763861237173287,
        .017469167995929485437, .017469167995929485437, .017469167995929485437,
        .004292374184832827705, .004292374184832827705, .004292374184832827705,
        .037468858210467644032, .037468858210467644032, .037468858210467644032,
        .037468858210467644032, .037468858210467644032, .037468858210467644032,
        .026949352591879961044, .026949352591879961044, .026949352591879961044,
        .026949352591879961044, .026949352591879961044, .026949352591879961044,
        .08117796029686715951547596874982357, #11-28
        .012324043506909494118, .012324043506909494118, .012324043506909494118,
        .062828009744410107283, .062828009744410107283, .062828009744410107283,
        .012220379049364529755, .012220379049364529755, .012220379049364529755,
        .067701348952811509920, .067701348952811509920, .067701348952811509920,
        .040219693628851690423, .040219693628851690423, .040219693628851690423,
        .014762272717716101336, .014762272717716101336, .014762272717716101336,
        .014762272717716101336, .014762272717716101336, .014762272717716101336,
        .040727996458299039660, .040727996458299039660, .040727996458299039660,
        .040727996458299039660, .040727996458299039660, .040727996458299039660,
        .006166261051559017233, .006166261051559017233, .006166261051559017233, # 12-33
        .062858224217885100354, .062858224217885100354, .062858224217885100354,
        .034796112930708942989, .034796112930708942989, .034796112930708942989,
        .043692544538038402135, .043692544538038402135, .043692544538038402135,
        .025731066440455335417, .025731066440455335417, .025731066440455335417,
        .022356773202303445711, .022356773202303445711, .022356773202303445711, 
        .022356773202303445711, .022356773202303445711, .022356773202303445711,
        .017316231108658892371, .017316231108658892371, .017316231108658892371,
        .017316231108658892371, .017316231108658892371, .017316231108658892371,
        .040371557766380929517, .040371557766380929517, .040371557766380929517,
        .040371557766380929517, .040371557766380929517, .040371557766380929517,
        .067960036586831644281,                                                 #13-37
        .055601967530453328707, .055601967530453328707, .055601967530453328707,
        .058278485119199981404, .058278485119199981404, .058278485119199981404,
        .006052337103539171841, .006052337103539171841, .006052337103539171841,
        .023994401928894730773, .023994401928894730773, .023994401928894730773,
        .034641276140848370465, .034641276140848370465, .034641276140848370465,
        .034641276140848370465, .034641276140848370465, .034641276140848370465,
        .014965401105165667263, .014965401105165667263, .014965401105165667263,
        .014965401105165667263, .014965401105165667263, .014965401105165667263,
        .024179039811593819137, .024179039811593819137, .024179039811593819137,
        .024179039811593819137, .024179039811593819137, .024179039811593819137,
        .009590681003543262722, .009590681003543262722, .009590681003543262722,
        .009590681003543262722, .009590681003543262722, .009590681003543262722,
        .042162588736993017538, .042162588736993017538, .042162588736993017538, #14-42
        .004923403602400081681, .004923403602400081681, .004923403602400081681,
        .014433699669776667601, .014433699669776667601, .014433699669776667601,
        .032788353544125350641, .032788353544125350641, .032788353544125350641, 
        .021883581369428890640, .021883581369428890640, .021883581369428890640,
        .051774104507291586314, .051774104507291586314, .051774104507291586314,
        .024665753212563673962, .024665753212563673962, .024665753212563673962,
        .024665753212563673962, .024665753212563673962, .024665753212563673962,
        .038571510787060683228, .038571510787060683228, .038571510787060683228,
        .038571510787060683228, .038571510787060683228, .038571510787060683228,
        .014436308113533840496, .014436308113533840496, .014436308113533840496,
        .014436308113533840496, .014436308113533840496, .014436308113533840496,
        .005010228838500671769, .005010228838500671769, .005010228838500671769,
        .005010228838500671769, .005010228838500671769, .005010228838500671769,
        .023571267031906342066,                                                 #15-49
        .015173149557211704503, .015173149557211704503, .015173149557211704503,
        .012976001283928841549, .012976001283928841549, .012976001283928841549,
        .017066295968006156709, .017066295968006156709, .017066295968006156709,
        .045760019462737606984, .045760019462737606984, .045760019462737606984,
        .002227574472822231540, .002227574472822231540, .002227574472822231540,
        .002227574472822231540, .002227574472822231540, .002227574472822231540,
        .027010141659869471013, .027010141659869471013, .027010141659869471013,
        .027010141659869471013, .027010141659869471013, .027010141659869471013,
        .026083779639587564030, .026083779639587564030, .026083779639587564030,
        .026083779639587564030, .026083779639587564030, .026083779639587564030,
        .012110153277028283372, .012110153277028283372, .012110153277028283372,
        .012110153277028283372, .012110153277028283372, .012110153277028283372,
        .015647850596804445733, .015647850596804445733, .015647850596804445733,
        .015647850596804445733, .015647850596804445733, .015647850596804445733,
        .034170889379294792425, .034170889379294792425, .034170889379294792425,
        .034170889379294792425, .034170889379294792425, .034170889379294792425,
        .048022188680377090551,                                                 #16-55
        .014709100306801927103, .014709100306801927103, .014709100306801927103,
        .029544586549319255995, .029544586549319255995, .029544586549319255995,
        .026125017351088377498, .026125017351088377498, .026125017351088377498,
        .002780387352390006975, .002780387352390006975, .002780387352390006975,
        .031821773000536649503, .031821773000536649503, .031821773000536649503,
        .008645834349509659901, .008645834349509659901, .008645834349509659901,
        .014300332904495365146, .014300332904495365146, .014300332904495365146,
        .014300332904495365146, .014300332904495365146, .014300332904495365146,
        .027849777203600829952, .027849777203600829952, .027849777203600829952,
        .027849777203600829952, .027849777203600829952, .027849777203600829952,
        .007041673406636097562, .007041673406636097562, .007041673406636097562,
        .007041673406636097562, .007041673406636097562, .007041673406636097562,
        .017899838259933728601, .017899838259933728601, .017899838259933728601,
        .017899838259933728601, .017899838259933728601, .017899838259933728601,
        .027458200384349763072, .027458200384349763072, .027458200384349763072,
        .027458200384349763072, .027458200384349763072, .027458200384349763072,
        .007299796939431762084, .007299796939431762084, .007299796939431762084,
        .007299796939431762084, .007299796939431762084, .007299796939431762084,
        .038292540080035687494, .038292540080035687494, .038292540080035687494, #17-60
        .016695286997753395943, .016695286997753395943, .016695286997753395943,
        .001435124543590612244, .001435124543590612244, .001435124543590612244,
        .028642768491850536303, .028642768491850536303, .028642768491850536303,
        .034085690782062149647, .034085690782062149647, .034085690782062149647,
        .024672742000530890569, .024672742000530890569, .024672742000530890569,
        .005866797575371341542, .005866797575371341542, .005866797575371341542,
        .023218595004228961511, .023218595004228961511, .023218595004228961511,
        .030849654582514060991, .030849654582514060991, .030849654582514060991,
        .030849654582514060991, .030849654582514060991, .030849654582514060991,
        .018813985440054200387, .018813985440054200387, .018813985440054200387,
        .018813985440054200387, .018813985440054200387, .018813985440054200387,
        .005123434503972855550, .005123434503972855550, .005123434503972855550,
        .005123434503972855550, .005123434503972855550, .005123434503972855550,
        .007012393484752017771, .007012393484752017771, .007012393484752017771,
        .007012393484752017771, .007012393484752017771, .007012393484752017771,
        .015382294435044613113, .015382294435044613113, .015382294435044613113,
        .015382294435044613113, .015382294435044613113, .015382294435044613113,
        .003030131482617131224, .003030131482617131224, .003030131482617131224,
        .003030131482617131224, .003030131482617131224, .003030131482617131224,
        .030748521239115855399,                                                 #18-67
        .020318338845458397305, .020318338845458397305, .020318338845458397305,
        .013790286604766938801, .013790286604766938801, .013790286604766938801,
        .000532005616947780561, .000532005616947780561, .000532005616947780561,
        .033471994059847898118, .033471994059847898118, .033471994059847898118,
        .031116396602006131196, .031116396602006131196, .031116396602006131196,
        .013107027491738755678, .013107027491738755678, .013107027491738755678,
        .016911653917480078794, .016911653917480078794, .016911653917480078794,
        .016911653917480078794, .016911653917480078794, .016911653917480078794,
        .027592886488579478020, .027592886488579478020, .027592886488579478020,
        .027592886488579478020, .027592886488579478020, .027592886488579478020,
        .016365908413986565958, .016365908413986565958, .016365908413986565958,
        .016365908413986565958, .016365908413986565958, .016365908413986565958,
        .007641704972719635950, .007641704972719635950, .007641704972719635950,
        .007641704972719635950, .007641704972719635950, .007641704972719635950,
        .007729835280006227008, .007729835280006227008, .007729835280006227008,
        .007729835280006227008, .007729835280006227008, .007729835280006227008,
        .009586124474361503760, .009586124474361503760, .009586124474361503760,
        .009586124474361503760, .009586124474361503760, .009586124474361503760,
        .004217516774744442909, .004217516774744442909, .004217516774744442909,
        .004217516774744442909, .004217516774744442909, .004217516774744442909,
        .015328258194553140867, .015328258194553140867, .015328258194553140867,
        .015328258194553140867, .015328258194553140867, .015328258194553140867,
        .032906331388918652083,                                                 #19-73
        .010330731891272053367, .010330731891272053367, .010330731891272053367,
        .022387247263016392529, .022387247263016392529, .022387247263016392529,
        .030266125869468070865, .030266125869468070865, .030266125869468070865,
        .030490967802197781000, .030490967802197781000, .030490967802197781000,
        .024159212741640904911, .024159212741640904911, .024159212741640904911,
        .016050803586800875291, .016050803586800875291, .016050803586800875291,
        .008084580261784060481, .008084580261784060481, .008084580261784060481,
        .002079362027484780751, .002079362027484780751, .002079362027484780751,
        .003884876904981389756, .003884876904981389756, .003884876904981389756,
        .003884876904981389756, .003884876904981389756, .003884876904981389756,
        .025574160612021903892, .025574160612021903892, .025574160612021903892,
        .025574160612021903892, .025574160612021903892, .025574160612021903892,
        .008880903573338057745, .008880903573338057745, .008880903573338057745,
        .008880903573338057745, .008880903573338057745, .008880903573338057745,
        .016124546761731391219, .016124546761731391219, .016124546761731391219,
        .016124546761731391219, .016124546761731391219, .016124546761731391219,
        .002491941817490675440, .002491941817490675440, .002491941817490675440,
        .002491941817490675440, .002491941817490675440, .002491941817490675440,
        .018242840118950578377, .018242840118950578377, .018242840118950578377,
        .018242840118950578377, .018242840118950578377, .018242840118950578377,
        .010258563736198521308, .010258563736198521308, .010258563736198521308,
        .010258563736198521308, .010258563736198521308, .010258563736198521308,
        .003799928855301913979, .003799928855301913979, .003799928855301913979,
        .003799928855301913979, .003799928855301913979, .003799928855301913979,
        .023438988376216853375,                                                 #20-82
        .017011878870651791408, .017011878870651791408, .017011878870651791408,
        .022134629025398471497, .022134629025398471497, .022134629025398471497,
        .022250120341489367048, .022250120341489367048, .022250120341489367048,
        .021088014275187657289, .021088014275187657289, .021088014275187657289,
        .014366731982372506741, .014366731982372506741, .014366731982372506741,
        .005960642473090548701, .005960642473090548701, .005960642473090548701,
        .001854461856388562260, .001854461856388562260, .001854461856388562260,
        .007665037998881734679, .007665037998881734679, .007665037998881734679,
        .007665037998881734679, .007665037998881734679, .007665037998881734679,
        .006110966413772695644, .006110966413772695644, .006110966413772695644,
        .006110966413772695644, .006110966413772695644, .006110966413772695644,
        .003297501228907503424, .003297501228907503424, .003297501228907503424,
        .003297501228907503424, .003297501228907503424, .003297501228907503424,
        .002585043287457842439, .002585043287457842439, .002585043287457842439,
        .002585043287457842439, .002585043287457842439, .002585043287457842439,
        .016048299663468336861, .016048299663468336861, .016048299663468336861,
        .016048299663468336861, .016048299663468336861, .016048299663468336861,
        .009873791477894466876, .009873791477894466876, .009873791477894466876,
        .009873791477894466876, .009873791477894466876, .009873791477894466876,
        .008173147417690080895, .008173147417690080895, .008173147417690080895,
        .008173147417690080895, .008173147417690080895, .008173147417690080895,
        .021272124208127078037, .021272124208127078037, .021272124208127078037,
        .021272124208127078037, .021272124208127078037, .021272124208127078037,
        .016295599680726785773, .016295599680726785773, .016295599680726785773,
        .016295599680726785773, .016295599680726785773, .016295599680726785773,
        .019105417814747880665, .019105417814747880665, .019105417814747880665,
        .019105417814747880665, .019105417814747880665, .019105417814747880665,
        ], dtype=np.float64)

    nodes = np.array([
        [.3333333333333333, .3333333333333333, .3333333333333333   ],#1-1
        [.16666666666666666, .16666666666666666, .66666666666666667],#2-3
        [.16666666666666666, .66666666666666667, .16666666666666666],
        [.66666666666666667, .16666666666666666, .16666666666666666], 
        [.1628828503958919, .1628828503958919, .6742342992082162   ],#3-6
        [.1628828503958919, .6742342992082162, .1628828503958919   ],
        [.6742342992082162, .1628828503958919, .1628828503958919   ],
        [.4779198835675637, .4779198835675637, .0441602328648726   ],
        [.4779198835675637, .0441602328648726, .4779198835675637   ],
        [.0441602328648726, .4779198835675637, .4779198835675637   ],
        [.4459484909159649, .4459484909159649, .10810301816807022  ],#4-6
        [.4459484909159649, .10810301816807022, .4459484909159649  ],
        [.10810301816807022, .4459484909159649, .4459484909159649  ],
        [.0915762135097707, .0915762135097707, .8168475729804586   ],
        [.0915762135097707, .8168475729804586, .0915762135097707   ],
        [.8168475729804586, .0915762135097707, .0915762135097707   ],
        [.3333333333333333, .3333333333333333, .3333333333333333   ], #5-7
        [.1012865073234563, .1012865073234563, .7974269853530874   ],
        [.1012865073234563, .7974269853530874, .1012865073234563   ],
        [.7974269853530874, .1012865073234563, .1012865073234563   ],
        [.4701420641051151, .4701420641051151, .05971587178976978  ],
        [.4701420641051151, .05971587178976978, .4701420641051151  ],
        [.05971587178976978, .4701420641051151, .4701420641051151  ],
        [.0630890144915022, .0630890144915022, .8738219710169957], #6-12
        [.0630890144915022, .8738219710169957, .0630890144915022],
        [.8738219710169957, .0630890144915022, .0630890144915022],
        [.2492867451709104, .2492867451709104, .5014265096581791],
        [.2492867451709104, .5014265096581791, .2492867451709104],
        [.5014265096581791, .2492867451709104, .2492867451709104],
        [.0531450498448169, .3103524510337844, .6365024991213987],
        [.3103524510337844, .0531450498448169, .6365024991213987],
        [.0531450498448169, .6365024991213987, .3103524510337844],
        [.3103524510337844, .6365024991213987, .0531450498448169],
        [.6365024991213987, .0531450498448169, .3103524510337844],
        [.6365024991213987, .3103524510337844, .0531450498448169],
        [.0282639241560763, .0282639241560763, .9434721516878474], #7-15
        [.0282639241560763, .9434721516878474, .0282639241560763],
        [.9434721516878474, .0282639241560763, .0282639241560763],
        [.4743113232672225, .4743113232672225, .0513773534655548],
        [.4743113232672225, .0513773534655548, .4743113232672225],
        [.0513773534655548, .4743113232672225, .4743113232672225],
        [.2411433258498488, .2411433258498488, .5177133483003025],
        [.2411433258498488, .5177133483003025, .2411433258498488],
        [.5177133483003025, .2411433258498488, .2411433258498488],
        [.7612227480245238, .0462708777988089, .1925063741766673],
        [.0462708777988089, .7612227480245238, .1925063741766673],
        [.7612227480245238, .1925063741766673, .0462708777988089],
        [.0462708777988089, .1925063741766673, .7612227480245238],
        [.1925063741766673, .0462708777988089, .7612227480245238],
        [.1925063741766673, .7612227480245238, .0462708777988089],
        [.3333333333333333, .3333333333333333, .3333333333333333], # 8-16
        [.1705693077517602, .1705693077517602, .6588613844964796], #3
        [.1705693077517602, .6588613844964796, .1705693077517602],
        [.6588613844964796, .1705693077517602, .1705693077517602],
        [.0505472283170310, .0505472283170310, .898905543365938], #3
        [.0505472283170310, .898905543365938, .0505472283170310],
        [.898905543365938, .0505472283170310, .0505472283170310],
        [.459292588292723156, .459292588292723156, .08141482341455364], #3
        [.459292588292723156, .08141482341455364, .459292588292723156],
        [.08141482341455364, .459292588292723156, .459292588292723156],
        [.263112829634638113, .008394777409957605, .7284923929554042], #6
        [.008394777409957605, .263112829634638113, .7284923929554042],
        [.263112829634638113, .7284923929554042, .008394777409957605],
        [.008394777409957605, .7284923929554042, .263112829634638113],
        [.7284923929554042, .263112829634638113, .008394777409957605],
        [.7284923929554042, .008394777409957605, .263112829634638113],
        [.333333333333333333, .333333333333333333, .333333333333333333], # 9-19
        [.489682519198737627, .489682519198737627, .02063496160252475], #3
        [.489682519198737627, .02063496160252475, .489682519198737627],
        [.02063496160252475, .489682519198737627, .489682519198737627],
        [.04472951339445271207, .04472951339445271207, .91054097321109457586], #3
        [.04472951339445271207, .91054097321109457586, .04472951339445271207],
        [.91054097321109457586, .04472951339445271207, .04472951339445271207],
        [.43708959149293663549, .43708959149293663549, .12582081701412672903], #3
        [.43708959149293663549, .12582081701412672903, .43708959149293663549],
        [.12582081701412672903, .43708959149293663549, .43708959149293663549],
        [.1882035356190327191, .1882035356190327191, .6235929287619345618], #3
        [.1882035356190327191, .6235929287619345618, .1882035356190327191],
        [.6235929287619345618, .1882035356190327191, .1882035356190327191],
        [.7411985987844980084, .22196298916076570573, .036838412054736285883], # 6
        [.22196298916076570573, .7411985987844980084, .036838412054736285883],
        [.7411985987844980084, .036838412054736285883, .22196298916076570573],
        [.22196298916076570573, .036838412054736285883, .7411985987844980084],
        [.036838412054736285883, .7411985987844980084, .22196298916076570573],
        [.036838412054736285883, .22196298916076570573, .7411985987844980084],
        [.333333333333333333, .333333333333333333, .333333333333333333],        # 10-25
        [.4272731788467755143, .4272731788467755143, .14545364230644897141], #3
        [.4272731788467755143, .14545364230644897141, .4272731788467755143],
        [.14545364230644897141, .4272731788467755143, .4272731788467755143],
        [.18309922244867501973, .18309922244867501973, .63380155510264996055], #3
        [.18309922244867501973, .63380155510264996055, .18309922244867501973],
        [.63380155510264996055, .18309922244867501973, .18309922244867501973],
        [.49043401970113059685, .49043401970113059685, .019131960597738806307], #3
        [.49043401970113059685, .019131960597738806307, .49043401970113059685],
        [.019131960597738806307, .49043401970113059685, .49043401970113059685],
        [.012572445551580532785, .012572445551580532785, .97485510889683893443], #3
        [.012572445551580532785, .97485510889683893443, .012572445551580532785],
        [.97485510889683893443, .012572445551580532785, .012572445551580532785],
        [.65426866792006610485, .30804600168524770565, .037685330394686189504], #6
        [.30804600168524770565, .65426866792006610485, .037685330394686189504],
        [.65426866792006610485, .037685330394686189504, .30804600168524770565],
        [.30804600168524770565, .037685330394686189504, .65426866792006610485],
        [.037685330394686189504, .65426866792006610485, .30804600168524770565],
        [.037685330394686189504, .30804600168524770565, .65426866792006610485],
        [.12280457706855926747, .03337183373930478758, .84382358919213594495],  #6
        [.03337183373930478758, .12280457706855926747, .84382358919213594495],
        [.12280457706855926747, .84382358919213594495, .03337183373930478758],
        [.03337183373930478758, .84382358919213594495, .12280457706855926747],
        [.84382358919213594495, .12280457706855926747, .03337183373930478758],
        [.84382358919213594495, .03337183373930478758, .12280457706855926747],
        [.333333333333333333, .333333333333333333, .333333333333333333],        # 11-28
        [.030938355245430784, .030938355245430784, .938123289509138480], #3
        [.030938355245430784, .938123289509138480, .030938355245430784],
        [.938123289509138480, .030938355245430784, .030938355245430784],
        [.436498181134128842, .436498181134128842, .127003637731742280], #3
        [.436498181134128842, .127003637731742280, .436498181134128842],
        [.127003637731742280, .436498181134128842, .436498181134128842],
        [.498984763702593266, .498984763702593266, .002030472594813482], #3
        [.498984763702593266, .002030472594813482, .498984763702593266],
        [.002030472594813482, .498984763702593266, .498984763702593266],
        [.214688197958594336, .214688197958594336, .570623604082811320], #3
        [.214688197958594336, .570623604082811320, .214688197958594336], 
        [.570623604082811320, .214688197958594336, .214688197958594336], 
        [.113683104042113390, .113683104042113390, .772633791915773194], #3
        [.113683104042113390, .772633791915773194, .113683104042113390],
        [.772633791915773194, .113683104042113390, .113683104042113390],
        [.825618766164862904, .159742304591850189, .014638929243286969], #6
        [.159742304591850189, .825618766164862904, .014638929243286969],
        [.825618766164862904, .014638929243286969, .159742304591850189],
        [.159742304591850189, .014638929243286969, .825618766164862904],
        [.014638929243286969, .825618766164862904, .159742304591850189],
        [.014638929243286969, .159742304591850189, .825618766164862904],
        [.640472310134865267, .311783715709599000, .047743974155535718], #6
        [.311783715709599000, .640472310134865267, .047743974155535718],
        [.640472310134865267, .047743974155535718, .311783715709599000],
        [.311783715709599000, .047743974155535718, .640472310134865267],
        [.047743974155535718, .640472310134865267, .311783715709599000],
        [.047743974155535718, .311783715709599000, .640472310134865267],
        [.021317350453210371, .021317350453210371, .957365299093579258], #3   #12-33
        [.021317350453210371, .957365299093579258, .021317350453210371],
        [.957365299093579258, .021317350453210371, .021317350453210371],
        [.271210385012115918, .271210385012115918, .457579229975768165], #3 
        [.271210385012115922, .457579229975768165, .271210385012115918],
        [.457579229975768165, .271210385012115918, .271210385012115918],
        [.127576145541585917, .127576145541585917, .744847708916828166], #3
        [.127576145541585917, .744847708916828166, .127576145541585917],
        [.744847708916828166, .127576145541585917, .127576145541585917],
        [.439724392294460253, .439724392294460253, .120551215411079493], #3
        [.439724392294460253, .120551215411079493, .439724392294460253],
        [.120551215411079493, .439724392294460253, .439724392294460253],
        [.488217389773804855, .488217389773804855, .023565220452390290], #3
        [.488217389773804855, .023565220452390290, .488217389773804855],
        [.023565220452390290, .488217389773804855, .488217389773804855],
        [.695836086787803398, .281325580989939539, .022838332222257063], #6
        [.281325580989939539, .695836086787803398, .022838332222257063],
        [.695836086787803398, .022838332222257063, .281325580989939539],
        [.281325580989939539, .022838332222257063, .695836086787803398],
        [.022838332222257063, .695836086787803398, .281325580989939539],
        [.022838332222257063, .281325580989939539, .695836086787803398],
        [.858014033544072630, .116251915907597141, .025734050548330167], #6
        [.116251915907597141, .858014033544072630, .025734050548330167],
        [.858014033544072630, .025734050548330167, .116251915907597141],
        [.116251915907597141, .025734050548330167, .858014033544072630],
        [.025734050548330167, .858014033544072630, .116251915907597141],
        [.025734050548330167, .116251915907597141, .858014033544072630],
        [.608943235779787817, .275713269685514184, .115343494534697999], #6
        [.275713269685514184, .608943235779787817, .115343494534697999],
        [.608943235779787817, .115343494534697999, .275713269685514184],
        [.275713269685514184, .115343494534697999, .608943235779787817],
        [.115343494534697999, .608943235779787817, .275713269685514184],
        [.115343494534697999, .275713269685514184, .608943235779787817],
        [.333333333333333333, .333333333333333333, .333333333333333333], #1 #13-37
        [.426941414259800406, .426941414259800406, .146117171480399155], #3
        [.426941414259800406, .146117171480399155, .426941414259800406],
        [.146117171480399155, .426941414259800406, .426941414259800406],
        [.221372286291832893, .221372286291832893, .557255427416334159], #3
        [.221372286291832893, .557255427416334159, .221372286291832893],
        [.557255427416334159, .221372286291832893, .221372286291832893],
        [.021509681108843184, .021509681108843184, .956980637782313681], #3
        [.021509681108843184, .956980637782313681, .021509681108843184],
        [.956980637782313681, .021509681108843184, .021509681108843184],
        [.489076946452539352, .489076946452539352, .021846107094921297], #3
        [.489076946452539352, .021846107094921297, .489076946452539352], 
        [.021846107094921297, .489076946452539352, .489076946452539352], 
        [.623545995553675625, .308441760892117778, .068012243554206597], #6
        [.308441760892117778, .623545995553675625, .068012243554206597],
        [.623545995553675625, .068012243554206597, .308441760892117778],
        [.308441760892117778, .068012243554206597, .623545995553675625],
        [.068012243554206597, .623545995553675625, .308441760892117778],
        [.068012243554206597, .308441760892117778, .623545995553675625],
        [.864707770295442768, .110922042803463392, .024370186901093840], #6
        [.110922042803463392, .864707770295442768, .024370186901093840],
        [.864707770295442768, .024370186901093840, .110922042803463392],
        [.110922042803463392, .024370186901093840, .864707770295442768],
        [.024370186901093840, .864707770295442768, .110922042803463392],
        [.024370186901093840, .110922042803463392, .864707770295442768],
        [.748507115899952225, .163597401067850479, .087895483032197297], #6
        [.163597401067850479, .748507115899952225, .087895483032197297],
        [.748507115899952225, .087895483032197297, .163597401067850479],
        [.163597401067850479, .087895483032197297, .748507115899952225],
        [.087895483032197297, .748507115899952225, .163597401067850479],
        [.087895483032197297, .163597401067850479, .748507115899952225],
        [.722357793124188019, .272515817773429647, .005126389102382334], #6
        [.272515817773429647, .722357793124188019, .005126389102382334],
        [.722357793124188019, .005126389102382334, .272515817773429647],
        [.272515817773429647, .005126389102382334, .722357793124188019],
        [.005126389102382334, .722357793124188019, .272515817773429647],
        [.005126389102382334, .272515817773429647, .722357793124188019],
        [.177205532412543443, .177205532412543443, .645588935174913114], #3 #14-42
        [.177205532412543443, .645588935174913114, .177205532412543443],
        [.645588935174913114, .177205532412543443, .177205532412543443],
        [.019390961248701048, .019390961248701048, .961218077502597912], #3
        [.019390961248701048, .961218077502597912, .019390961248701048],
        [.961218077502597912, .019390961248701048, .019390961248701048],
        [.061799883090872601, .061799883090872601, .876400233818254826], #3
        [.061799883090872601, .876400233818254826, .061799883090872601],
        [.876400233818254826, .061799883090872601, .061799883090872601],
        [.417644719340453940, .417644719340453940, .164710561319092119], #3
        [.417644719340453940, .164710561319092119, .417644719340453940],
        [.164710561319092119, .417644719340453940, .417644719340453940],
        [.488963910362178622, .488963910362178622, .022072179275642756], #3
        [.488963910362178622, .022072179275642756, .488963910362178622],
        [.022072179275642756, .488963910362178622, .488963910362178622],
        [.273477528308838647, .273477528308838647, .453044943382322707], #3
        [.273477528308838647, .453044943382322707, .273477528308838647],
        [.453044943382322707, .273477528308838647, .273477528308838647],
        [.172266687821355569, .057124757403647940, .770608554774996457], #6
        [.057124757403647940, .172266687821355569, .770608554774996457],
        [.172266687821355569, .770608554774996457, .057124757403647940],
        [.057124757403647940, .770608554774996457, .172266687821355569],
        [.770608554774996457, .172266687821355569, .057124757403647940],
        [.770608554774996457, .057124757403647940, .172266687821355569],
        [.570222290846683189, .092916249356971820, .336861459796344964], #6
        [.092916249356971820, .570222290846683189, .336861459796344964],
        [.570222290846683189, .336861459796344964, .092916249356971820],
        [.092916249356971820, .336861459796344964, .570222290846683189],
        [.336861459796344964, .570222290846683189, .092916249356971820],
        [.336861459796344964, .092916249356971820, .570222290846683189],
        [.298372882136257733, .014646950055654410, .686980167808087905], #6
        [.014646950055654410, .298372882136257733, .686980167808087905],
        [.298372882136257733, .686980167808087905, .014646950055654410],
        [.014646950055654410, .686980167808087905, .298372882136257733],
        [.686980167808087905, .298372882136257733, .014646950055654410],
        [.686980167808087905, .014646950055654410, .298372882136257733],
        [.118974497696956852, .001268330932872025, .879757171370171065], #6
        [.001268330932872025, .118974497696956852, .879757171370171065],
        [.118974497696956852, .879757171370171065, .001268330932872025],
        [.001268330932872025, .879757171370171065, .118974497696956852],
        [.879757171370171065, .118974497696956852, .001268330932872025],
        [.879757171370171065, .001268330932872025, .118974497696956852],
        [.333333333333333333, .333333333333333333, .333333333333333333], #1 #15-49
        [.110222296228346867, .110222296228346867, .779555407543306211], #3
        [.110222296228346867, .779555407543306211, .110222296228346867],
        [.779555407543306211, .110222296228346867, .110222296228346867],
        [.05197643301003435 , .05197643301003435 , .8960471339799313  ], #3
        [.05197643301003435 , .8960471339799313  , .05197643301003435 ],
        [.8960471339799313  , .05197643301003435 , .05197643301003435 ],
        [.49114565807532556 , .49114565807532556 , .017708683849348872], #3
        [.49114565807532556 , .017708683849348872, .49114565807532556 ],
        [.017708683849348872, .49114565807532556 , .49114565807532556 ],
        [.39315718888435885 , .39315718888435885 , .2136856222312823  ], #3
        [.39315718888435885 , .2136856222312823  , .39315718888435885 ],
        [.2136856222312823  , .39315718888435885 , .39315718888435885 ],
        [.03737440487572919 , .9625183522300121  , .000107242894258675], #6
        [.9625183522300121  , .03737440487572919 , .000107242894258675],
        [.03737440487572919 , .000107242894258675, .9625183522300121  ],
        [.9625183522300121  , .000107242894258675, .03737440487572919 ],
        [.000107242894258675, .03737440487572919 , .9625183522300121  ],
        [.000107242894258675, .9625183522300121  , .03737440487572919 ],
        [.2482487779846732  , .19316669854521418 , .5585845234701127  ], #6
        [.19316669854521418 , .2482487779846732  , .5585845234701127  ],
        [.2482487779846732  , .5585845234701127  , .19316669854521418 ],
        [.19316669854521418 , .5585845234701127  , .2482487779846732  ],
        [.5585845234701127  , .2482487779846732  , .19316669854521418 ],
        [.5585845234701127  , .19316669854521418 , .2482487779846732  ],
        [.20699402274830217 , .08689590883549962 , .7061100684161983  ], #6
        [.08689590883549962 , .20699402274830217 , .7061100684161983  ],
        [.20699402274830217 , .7061100684161983  , .08689590883549962 ],
        [.08689590883549962 , .7061100684161983  , .20699402274830217 ],
        [.7061100684161983  , .20699402274830217 , .08689590883549962 ],
        [.7061100684161983  , .08689590883549962 , .20699402274830217 ],
        [.14854110526954709 , .017436825398454307, .8340220693319986  ], #6
        [.017436825398454307, .14854110526954709 , .8340220693319986  ],
        [.14854110526954709 , .8340220693319986  , .017436825398454307],
        [.017436825398454307, .8340220693319986  , .14854110526954709 ],
        [.8340220693319986  , .14854110526954709 , .017436825398454307],
        [.8340220693319986  , .017436825398454307, .14854110526954709 ],
        [.3067423792359638  , .01749251095825766 , .6757651098057785  ], #6
        [.01749251095825766 , .3067423792359638  , .6757651098057785  ],
        [.3067423792359638  , .6757651098057785  , .01749251095825766 ],
        [.01749251095825766 , .6757651098057785  , .3067423792359638  ],
        [.6757651098057785  , .3067423792359638  , .01749251095825766 ],
        [.6757651098057785  , .01749251095825766 , .3067423792359638  ],
        [.36703198754220473 , .09034802175864556 , .5426199906991497  ], #6
        [.09034802175864556 , .36703198754220473 , .5426199906991497  ],
        [.36703198754220473 , .5426199906991497  , .09034802175864556 ],
        [.09034802175864556 , .5426199906991497  , .36703198754220473 ],
        [.5426199906991497  , .36703198754220473 , .09034802175864556 ],
        [.5426199906991497  , .09034802175864556 , .36703198754220473 ],
        [.333333333333333333, .333333333333333333, .333333333333333333], #1 #16-55
        [.08179498313137387 , .08179498313137387 , .8364100337372522  ], #3
        [.08179498313137387 , .8364100337372522  , .08179498313137387 ],
        [.8364100337372522  , .08179498313137387 , .08179498313137387 ],
        [.16530060196977964 , .16530060196977964 , .6693987960604407  ], #3
        [.16530060196977964 , .6693987960604407  , .16530060196977964 ],
        [.6693987960604407  , .16530060196977964 , .16530060196977964 ],
        [.4685921053494614  , .4685921053494614  , .06281578930107723 ], #3
        [.4685921053494614  , .06281578930107723 , .4685921053494614  ],
        [.06281578930107723 , .4685921053494614  , .4685921053494614  ],
        [.014438813445416683, .014438813445416683, .9711223731091666  ], #3
        [.014438813445416683, .9711223731091666  , .014438813445416683],
        [.9711223731091666  , .014438813445416683, .014438813445416683],
        [.24178428539178334 , .24178428539178334 , .5164314292164334  ], #3
        [.24178428539178334 , .5164314292164334  , .24178428539178334 ],
        [.5164314292164334  , .24178428539178334 , .24178428539178334 ], 
        [.49531034298777    , .49531034298777    , .009379314024460017], #3
        [.49531034298777    , .009379314024460017, .49531034298777    ],
        [.009379314024460017, .49531034298777    , .49531034298777    ],
        [.6505134026613523  , .33139974453708954 , .018086852801558195], #6
        [.33139974453708954 , .6505134026613523  , .018086852801558195],
        [.6505134026613523  , .018086852801558195, .33139974453708954 ],
        [.33139974453708954 , .018086852801558195, .6505134026613523  ],
        [.018086852801558195, .6505134026613523  , .33139974453708954 ],
        [.018086852801558195, .33139974453708954 , .6505134026613523  ],
        [.604011281495997   , .3032471627499422  , .09274155575406079 ],#6
        [.3032471627499422  , .604011281495997   , .09274155575406079 ],
        [.604011281495997   , .09274155575406079 , .3032471627499422  ],
        [.3032471627499422  , .09274155575406079 , .604011281495997   ],
        [.09274155575406079 , .604011281495997   , .3032471627499422  ],
        [.09274155575406079 , .3032471627499422  , .604011281495997   ],
        [.8021682575747416  , .18802805952123716 , .0098036829040212  ], #6
        [.18802805952123716 , .8021682575747416  , .0098036829040212  ],
        [.8021682575747416  , .0098036829040212  , .18802805952123716 ],
        [.18802805952123716 , .0098036829040212  , .8021682575747416  ],
        [.0098036829040212  , .8021682575747416  , .18802805952123716 ],
        [.0098036829040212  , .18802805952123716 , .8021682575747416  ],
        [.7565056064428284  , .18350466852229685 , .059989725034874763], #6
        [.18350466852229685 , .7565056064428284  , .059989725034874763],
        [.7565056064428284  , .059989725034874763, .18350466852229685 ],
        [.18350466852229685 , .059989725034874763, .7565056064428284  ],
        [.059989725034874763, .7565056064428284  , .18350466852229685 ],
        [.059989725034874763, .18350466852229685 , .7565056064428284  ],
        [.46593843871411816 , .3596459487975046  , .17441561248837728 ], #6
        [.3596459487975046  , .46593843871411816 , .17441561248837728 ],
        [.46593843871411816 , .17441561248837728 , .3596459487975046  ],
        [.3596459487975046  , .17441561248837728 , .46593843871411816 ],
        [.17441561248837728 , .46593843871411816 , .3596459487975046  ],
        [.17441561248837728 , .3596459487975046  , .46593843871411816 ],
        [.9063948439920415  , .07719437129575543 , .016410784712203058], #6
        [.07719437129575543 , .9063948439920415  , .016410784712203058],
        [.9063948439920415  , .016410784712203058, .07719437129575543 ],
        [.07719437129575543 , .016410784712203058, .9063948439920415  ],
        [.016410784712203058, .9063948439920415  , .07719437129575543 ],
        [.016410784712203058, .07719437129575543 , .9063948439920415  ],
        [.24056306963626903  , .24056306963626903  , .5188738607274619   ], #3 #17-60
        [.24056306963626903  , .5188738607274619   , .24056306963626903  ], 
        [.5188738607274619   , .24056306963626903  , .24056306963626903  ],
        [.08092323589766073  , .08092323589766073  , .8381535282046786   ],
        [.08092323589766073  , .8381535282046786   , .08092323589766073  ],
        [.8381535282046786   , .08092323589766073  , .08092323589766073  ],
        [.01001414912499135  , .01001414912499135  , .9799717017500174   ],
        [.01001414912499135  , .9799717017500174   , .01001414912499135  ],
        [.9799717017500174   , .01001414912499135  , .01001414912499135  ],
        [.1543765207866329   , .1543765207866329   , .6912469584267342   ],
        [.1543765207866329   , .6912469584267342   , .1543765207866329   ],
        [.6912469584267342   , .1543765207866329   , .1543765207866329   ],
        [.4171698620199627   , .4171698620199627   , .1656602759600746   ],
        [.4171698620199627   , .1656602759600746   , .4171698620199627   ],
        [.1656602759600746   , .4171698620199627   , .4171698620199627   ],
        [.47086974573840096  , .47086974573840096  , .058260508523198085 ],
        [.47086974573840096  , .058260508523198085 , .47086974573840096  ],
        [.058260508523198085 , .47086974573840096  , .47086974573840096  ],
        [.498118033845422    , .498118033845422    , .0037639323091559485],
        [.498118033845422    , .0037639323091559485, .498118033845422    ],
        [.0037639323091559485, .498118033845422    , .498118033845422    ],
        [.36473840565291926  , .36473840565291926  , .2705231886941615   ], #3
        [.36473840565291926  , .2705231886941615   , .36473840565291926  ],
        [.2705231886941615   , .36473840565291926  , .36473840565291926  ],
        [.10986590708262615   , .3046657696986657    , .5854683232187081    ], #6
        [.3046657696986657    , .10986590708262615   , .5854683232187081    ],
        [.10986590708262615   , .5854683232187081    , .3046657696986657    ],
        [.3046657696986657    , .5854683232187081    , .10986590708262615   ],
        [.5854683232187081    , .10986590708262615   , .3046657696986657    ],
        [.5854683232187081    , .3046657696986657    , .10986590708262615   ],
        [.2049322746291879    , .052487583906454256  , .7425801414643578    ],
        [.052487583906454256  , .2049322746291879    , .7425801414643578    ],
        [.2049322746291879    , .7425801414643578    , .052487583906454256  ],
        [.052487583906454256  , .7425801414643578    , .2049322746291879    ],
        [.7425801414643578    , .2049322746291879    , .052487583906454256  ],
        [.7425801414643578    , .052487583906454256  , .2049322746291879    ],
        [.05813921564266244   , .015000539952259544  , .926860244405078     ],
        [.015000539952259544  , .05813921564266244   , .926860244405078     ],
        [.05813921564266244   , .926860244405078     , .015000539952259544  ],
        [.015000539952259544  , .926860244405078     , .05813921564266244   ],
        [.926860244405078     , .05813921564266244   , .015000539952259544  ],
        [.926860244405078     , .015000539952259544  , .05813921564266244   ],
        [.13859554086776482   , .015010233479731825  , .8463942256525033    ],
        [.015010233479731825  , .13859554086776482   , .8463942256525033    ],
        [.13859554086776482   , .8463942256525033    , .015010233479731825  ],
        [.015010233479731825  , .8463942256525033    , .13859554086776482   ],
        [.8463942256525033    , .13859554086776482   , .015010233479731825  ],
        [.8463942256525033    , .015010233479731825  , .13859554086776482   ],
        [.3466054695200926    , .02336212893314654   , .6300324015467609    ],
        [.02336212893314654   , .3466054695200926    , .6300324015467609    ],
        [.3466054695200926    , .6300324015467609    , .02336212893314654   ],
        [.02336212893314654   , .6300324015467609    , .3466054695200926    ],
        [.6300324015467609    , .3466054695200926    , .02336212893314654   ],
        [.6300324015467609    , .02336212893314654   , .3466054695200926    ],
        [.24821986889585593   , .00000099999999999966, .7517791311041441    ],
        [.00000099999999999966, .24821986889585593   , .7517791311041441    ],
        [.24821986889585593   , .7517791311041441    , .00000099999999999966],
        [.00000099999999999966, .7517791311041441    , .24821986889585593   ],
        [.7517791311041441    , .24821986889585593   , .00000099999999999966],
        [.7517791311041441    , .00000099999999999966, .24821986889585593   ],
        [.333333333333333333, .333333333333333333, .333333333333333333], #1 #18-67
        [.15163850697260486 , .15163850697260486 , .6967229860547903  ], #3
        [.15163850697260486 , .6967229860547903  , .15163850697260486 ],
        [.6967229860547903  , .15163850697260486 , .15163850697260486 ],
        [.07243870556733287 , .07243870556733287 , .8551225888653342  ],
        [.07243870556733287 , .8551225888653342  , .07243870556733287 ],
        [.8551225888653342  , .07243870556733287 , .07243870556733287 ],
        [.003758944341068346, .003758944341068346, .9924821113178633  ],
        [.003758944341068346, .9924821113178633  , .003758944341068346],
        [.9924821113178633  , .003758944341068346, .003758944341068346],
        [.4110671018759195  , .4110671018759195  , .177865796248161   ],
        [.4110671018759195  , .177865796248161   , .4110671018759195  ],
        [.177865796248161   , .4110671018759195  , .4110671018759195  ],
        [.2656146099053742  , .2656146099053742  , .46877078018925156 ],
        [.2656146099053742  , .46877078018925156 , .2656146099053742  ],
        [.46877078018925156 , .2656146099053742  , .2656146099053742  ],
        [.4749182113240457  , .4749182113240457  , .05016357735190857 ],
        [.4749182113240457  , .05016357735190857 , .4749182113240457  ],
        [.05016357735190857 , .4749182113240457  , .4749182113240457  ],
        [.06612245802840339 , .17847912556588763 , .7553984164057089  ],
        [.17847912556588763 , .06612245802840339 , .7553984164057089  ],
        [.06612245802840339 , .7553984164057089  , .17847912556588763 ],
        [.17847912556588763 , .7553984164057089  , .06612245802840339 ],
        [.7553984164057089  , .06612245802840339 , .17847912556588763 ],
        [.7553984164057089  , .17847912556588763 , .06612245802840339 ],
        [.26857330639601384 , .14906691012577383 , .5823597834782124  ],
        [.14906691012577383 , .26857330639601384 , .5823597834782124  ],
        [.26857330639601384 , .5823597834782124  , .14906691012577383 ],
        [.14906691012577383 , .5823597834782124  , .26857330639601384 ],
        [.5823597834782124  , .26857330639601384 , .14906691012577383 ],
        [.5823597834782124  , .14906691012577383 , .26857330639601384 ],
        [.3020619577128708  , .05401173533902424 , .6439263069481049  ],
        [.05401173533902424 , .3020619577128708  , .6439263069481049  ],
        [.3020619577128708  , .6439263069481049  , .05401173533902424 ],
        [.05401173533902424 , .6439263069481049  , .3020619577128708  ],
        [.6439263069481049  , .3020619577128708  , .05401173533902424 ],
        [.6439263069481049  , .05401173533902424 , .3020619577128708  ],
        [.13277883027138934 , .014331524778941954, .8528896449496687  ],
        [.014331524778941954, .13277883027138934 , .8528896449496687  ],
        [.13277883027138934 , .8528896449496687  , .014331524778941954],
        [.014331524778941954, .8528896449496687  , .13277883027138934 ],
        [.8528896449496687  , .13277883027138934 , .014331524778941954],
        [.8528896449496687  , .014331524778941954, .13277883027138934 ],
        [.2565061597742415  , .010505018819241936, .7329888214065166  ],
        [.010505018819241936, .2565061597742415  , .7329888214065166  ],
        [.2565061597742415  , .7329888214065166  , .010505018819241936],
        [.010505018819241936, .7329888214065166  , .2565061597742415  ],
        [.7329888214065166  , .2565061597742415  , .010505018819241936],
        [.7329888214065166  , .010505018819241936, .2565061597742415  ],
        [.41106566867461836 , .011691824674667086, .5772425066507145  ],
        [.011691824674667086, .41106566867461836 , .5772425066507145  ],
        [.41106566867461836 , .5772425066507145  , .011691824674667086],
        [.011691824674667086, .5772425066507145  , .41106566867461836 ],
        [.5772425066507145  , .41106566867461836 , .011691824674667086],
        [.5772425066507145  , .011691824674667086, .41106566867461836 ],
        [.04727614183265178 , .01249893248349544 , .9402249256838527  ],
        [.01249893248349544 , .04727614183265178 , .9402249256838527  ],
        [.04727614183265178 , .9402249256838527  , .01249893248349544 ],
        [.01249893248349544 , .9402249256838527  , .04727614183265178 ],
        [.9402249256838527  , .04727614183265178 , .01249893248349544 ],
        [.9402249256838527  , .01249893248349544 , .04727614183265178 ],
        [.38504403441316365 , .5245289252324957  , .09042704035434068 ],
        [.5245289252324957  , .38504403441316365 , .09042704035434068 ],
        [.38504403441316365 , .09042704035434068 , .5245289252324957  ],
        [.5245289252324957  , .09042704035434068 , .38504403441316365 ],
        [.09042704035434068 , .38504403441316365 , .5245289252324957  ],
        [.09042704035434068 , .5245289252324957  , .38504403441316365 ],
        [.333333333333333333, .333333333333333333, .333333333333333333], #1 #19-73
        [.48960998707300635 , .48960998707300635 , .020780025853987305], #3
        [.48960998707300635 , .020780025853987305, .48960998707300635 ],
        [.020780025853987305, .48960998707300635 , .48960998707300635 ],
        [.45453689269789266 , .45453689269789266 , .09092621460421468 ],
        [.45453689269789266 , .09092621460421468 , .45453689269789266 ],
        [.09092621460421468 , .45453689269789266 , .45453689269789266 ],
        [.4014166806494312  , .4014166806494312  , .1971666387011376  ],
        [.4014166806494312  , .1971666387011376  , .4014166806494312  ],
        [.1971666387011376  , .4014166806494312  , .4014166806494312  ],
        [.25555165440309763 , .25555165440309763 , .48889669119380474 ],
        [.25555165440309763 , .48889669119380474 , .25555165440309763 ],
        [.48889669119380474 , .25555165440309763 , .25555165440309763 ],
        [.17707794215212955 , .17707794215212955 , .6458441156957409  ],
        [.17707794215212955 , .6458441156957409  , .17707794215212955 ],
        [.6458441156957409  , .17707794215212955 , .17707794215212955 ],
        [.11006105322795186 , .11006105322795186 , .7798778935440963  ],
        [.11006105322795186 , .7798778935440963  , .11006105322795186 ],
        [.7798778935440963  , .11006105322795186 , .11006105322795186 ],
        [.05552862425183967 , .05552862425183967 , .8889427514963206  ],
        [.05552862425183967 , .8889427514963206  , .05552862425183967 ],
        [.8889427514963206  , .05552862425183967 , .05552862425183967 ],
        [.012621863777228669, .012621863777228669, .9747562724455426  ],
        [.012621863777228669, .9747562724455426  , .012621863777228669],
        [.9747562724455426  , .012621863777228669, .012621863777228669],
        [.600633794794645    , .39575478735694286  , .0036114178484121795], #3
        [.39575478735694286  , .600633794794645    , .0036114178484121795],
        [.600633794794645    , .0036114178484121795, .39575478735694286  ],
        [.39575478735694286  , .0036114178484121795, .600633794794645    ],
        [.0036114178484121795, .600633794794645    , .39575478735694286  ],
        [.0036114178484121795, .39575478735694286  , .600633794794645    ],
        [.13446675453077978  , .5576032615887839   , .30792998388043624  ],
        [.5576032615887839   , .13446675453077978  , .30792998388043624  ],
        [.13446675453077978  , .30792998388043624  , .5576032615887839   ],
        [.5576032615887839   , .30792998388043624  , .13446675453077978  ],
        [.30792998388043624  , .13446675453077978  , .5576032615887839   ],
        [.30792998388043624  , .5576032615887839   , .13446675453077978  ],
        [.7209870258173651   , .26456694840652023  , .014446025776114702 ],
        [.26456694840652023  , .7209870258173651   , .014446025776114702 ],
        [.7209870258173651   , .014446025776114702 , .26456694840652023  ],
        [.26456694840652023  , .014446025776114702 , .7209870258173651   ],
        [.014446025776114702 , .7209870258173651   , .26456694840652023  ],
        [.014446025776114702 , .26456694840652023  , .7209870258173651   ],
        [.5945270689558709   , .35853935220595057  , .0469335788381785   ],
        [.35853935220595057  , .5945270689558709   , .0469335788381785   ],
        [.5945270689558709   , .0469335788381785   , .35853935220595057  ],
        [.35853935220595057  , .0469335788381785   , .5945270689558709   ],
        [.0469335788381785   , .5945270689558709   , .35853935220595057  ],
        [.0469335788381785   , .35853935220595057  , .5945270689558709   ],
        [.8393314736808386   , .15780740596859474  , .002861120350566654 ],
        [.15780740596859474  , .8393314736808386   , .002861120350566654 ],
        [.8393314736808386   , .002861120350566654 , .15780740596859474  ],
        [.15780740596859474  , .002861120350566654 , .8393314736808386   ],
        [.002861120350566654 , .8393314736808386   , .15780740596859474  ],
        [.002861120350566654 , .15780740596859474  , .8393314736808386   ],
        [.22386142409791568  , .7010879789261734   , .07505059697591099  ],
        [.7010879789261734   , .22386142409791568  , .07505059697591099  ],
        [.22386142409791568  , .07505059697591099  , .7010879789261734   ],
        [.7010879789261734   , .07505059697591099  , .22386142409791568  ],
        [.07505059697591099  , .22386142409791568  , .7010879789261734   ],
        [.07505059697591099  , .7010879789261734   , .22386142409791568  ],
        [.8229313240698566   , .14242160111338345  , .034647074816759965 ],
        [.14242160111338345  , .8229313240698566   , .034647074816759965 ],
        [.8229313240698566   , .034647074816759965 , .14242160111338345  ],
        [.14242160111338345  , .034647074816759965 , .8229313240698566   ],
        [.034647074816759965 , .8229313240698566   , .14242160111338345  ],
        [.034647074816759965 , .14242160111338345  , .8229313240698566   ],
        [.924344252620784    , .0654946280829377   , .01016111929627829  ],
        [.0654946280829377   , .924344252620784    , .01016111929627829  ],
        [.924344252620784    , .01016111929627829  , .0654946280829377   ],
        [.0654946280829377   , .01016111929627829  , .924344252620784    ],
        [.01016111929627829  , .924344252620784    , .0654946280829377   ],
        [.01016111929627829  , .0654946280829377   , .924344252620784    ],
        [.333333333333333333, .333333333333333333, .333333333333333333], #1 #20-82
        [.47253969049374944 , .47253969049374944 , .054920619012501115],
        [.47253969049374944 , .054920619012501115, .47253969049374944 ],
        [.054920619012501115, .47253969049374944 , .47253969049374944 ],
        [.43559179765819056 , .43559179765819056 , .12881640468361888 ],
        [.43559179765819056 , .12881640468361888 , .43559179765819056 ],
        [.12881640468361888 , .43559179765819056 , .43559179765819056 ],
        [.3854831776909541  , .3854831776909541  , .22903364461809184 ],
        [.3854831776909541  , .22903364461809184 , .3854831776909541  ],
        [.22903364461809184 , .3854831776909541  , .3854831776909541  ],
        [.1858978726693826  , .1858978726693826  , .6282042546612348  ],
        [.1858978726693826  , .6282042546612348  , .1858978726693826  ],
        [.6282042546612348  , .1858978726693826  , .1858978726693826  ],
        [.10294309387227568 , .10294309387227568 , .7941138122554486  ],
        [.10294309387227568 , .7941138122554486  , .10294309387227568 ],
        [.7941138122554486  , .10294309387227568 , .10294309387227568 ],
        [.044204356822104995, .044204356822104995, .91159128635579    ],
        [.044204356822104995, .91159128635579    , .044204356822104995],
        [.91159128635579    , .044204356822104995, .044204356822104995],
        [.011877000081949909, .011877000081949909, .9762459998361002  ],
        [.011877000081949909, .9762459998361002  , .011877000081949909],
        [.9762459998361002  , .011877000081949909, .011877000081949909],
        [.423177101943936   , .5662468142121674  , .010576083843896633], #6
        [.5662468142121674  , .423177101943936   , .010576083843896633],
        [.423177101943936   , .010576083843896633, .5662468142121674  ],
        [.5662468142121674  , .010576083843896633, .423177101943936   ],
        [.010576083843896633, .423177101943936   , .5662468142121674  ],
        [.010576083843896633, .5662468142121674  , .423177101943936   ],
        [.28717803493735133 , .7036313437500817  , .009190621312566871], #6
        [.7036313437500817  , .28717803493735133 , .009190621312566871],
        [.28717803493735133 , .009190621312566871, .7036313437500817  ],
        [.7036313437500817  , .009190621312566871, .28717803493735133 ],
        [.009190621312566871, .28717803493735133 , .7036313437500817  ],
        [.009190621312566871, .7036313437500817  , .28717803493735133 ],
        [.16282486571070318 , .8323733111605474  , .004801823128749438], #6
        [.8323733111605474  , .16282486571070318 , .004801823128749438],
        [.16282486571070318 , .004801823128749438, .8323733111605474  ],
        [.8323733111605474  , .004801823128749438, .16282486571070318 ],
        [.004801823128749438, .16282486571070318 , .8323733111605474  ],
        [.004801823128749438, .8323733111605474  , .16282486571070318 ],
        [.06468063449817511 , .9292576994583756  , .006061666043449376], #6
        [.9292576994583756  , .06468063449817511 , .006061666043449376],
        [.06468063449817511 , .006061666043449376, .9292576994583756  ],
        [.9292576994583756  , .006061666043449376, .06468063449817511 ],
        [.006061666043449376, .06468063449817511 , .9292576994583756  ],
        [.006061666043449376, .9292576994583756  , .06468063449817511 ],
        [.3340062770051191  , .613237016399388   , .05275670659549292 ], #6
        [.613237016399388   , .3340062770051191  , .05275670659549292 ],
        [.3340062770051191  , .05275670659549292 , .613237016399388   ],
        [.613237016399388   , .05275670659549292 , .3340062770051191  ],
        [.05275670659549292 , .3340062770051191  , .613237016399388   ],
        [.05275670659549292 , .613237016399388   , .3340062770051191  ],
        [.21092379552418128 , .7515105149060105  , .037565689569808214], #6
        [.7515105149060105  , .21092379552418128 , .037565689569808214],
        [.21092379552418128 , .037565689569808214, .7515105149060105  ],
        [.7515105149060105  , .037565689569808214, .21092379552418128 ],
        [.037565689569808214, .21092379552418128 , .7515105149060105  ],
        [.037565689569808214, .7515105149060105  , .21092379552418128 ],
        [.11508038084136832 , .8501511315621029  , .03476848759652884 ], #6
        [.8501511315621029  , .11508038084136832 , .03476848759652884 ],
        [.11508038084136832 , .03476848759652884 , .8501511315621029  ],
        [.8501511315621029  , .03476848759652884 , .11508038084136832 ],
        [.03476848759652884 , .11508038084136832 , .8501511315621029  ],
        [.03476848759652884 , .8501511315621029  , .11508038084136832 ],
        [.3107520864650843  , .5619897495395362  , .12725816399537948 ], #6
        [.5619897495395362  , .3107520864650843  , .12725816399537948 ],
        [.3107520864650843  , .12725816399537948 , .5619897495395362  ],
        [.5619897495395362  , .12725816399537948 , .3107520864650843  ],
        [.12725816399537948 , .3107520864650843  , .5619897495395362  ],
        [.12725816399537948 , .5619897495395362  , .3107520864650843  ],
        [.202006198010459   , .7017164402361619  , .09627736175337909 ], #6
        [.7017164402361619  , .202006198010459   , .09627736175337909 ],
        [.202006198010459   , .09627736175337909 , .7017164402361619  ],
        [.7017164402361619  , .09627736175337909 , .202006198010459   ],
        [.09627736175337909 , .202006198010459   , .7017164402361619  ],
        [.09627736175337909 , .7017164402361619  , .202006198010459   ],
        [.2890232079089593  , .4913885623231921  , .2195882297678486  ], #6
        [.4913885623231921  , .2890232079089593  , .2195882297678486  ],
        [.2890232079089593  , .2195882297678486  , .4913885623231921  ],
        [.4913885623231921  , .2195882297678486  , .2890232079089593  ],
        [.2195882297678486  , .2890232079089593  , .4913885623231921  ],
        [.2195882297678486  , .4913885623231921  , .2890232079089593  ],
        ], dtype=np.float64)
    # Order:  1 2 3 4 5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21
    # points: 1 3 6 6 7 12 15 16 19 25 28 33 37 42 49 55 60 67 73 82 87
    ind = np.array([0,   1,   4,  10,  16,  23,  35,  50,  66, 85, 
            110, 138, 171, 208, 250, 299, 354, 414, 481, 554, 636, 723])
    
    if nprecision < 1:
        nprecision = 1

    if nprecision > 20:
        raise Exception('QUADS/QUAD_TRIANGLE: Precision should not exceed 20.')

    return area*weights[ ind[nprecision-1] : ind[nprecision] ],\
        nodes[ind[nprecision-1] : ind[nprecision]]


@nb.njit(nb.types.Tuple((nb.float64[:], nb.float64[:,:]))(nb.int64, \
    nb.float64[:,:], nb.float64[:]))
def quad_subtriangle(k, coords, coord_center):
    '''
    Purpose: return weights and points on 
    Parameter:
        k -  (i, int64, 1 by 1) precision order
        coords	- (i, 1 by 2)   coordinates of polygonal vertices,
                                vertices list: v0, v1, ..., vn
        weights - (o, n by 1)   n weights
        points  - (o, n by 2)   coords of n quad points
    Date:
        Jun 4, 2020
    '''
    # Create data for sub triangles
    # - number of sub triangles
    nt = coords.shape[0]
    # - 1st triangle with center and vertices (vn, v0)
    tri = np.zeros((3,2), dtype=np.float64)
    tri[0,:] = coord_center
    tri[1,:] = coords[-1,:]
    tri[2,:] = coords[0,:]
    tri_area = tl.area_triangle(tri)

    # Compute quad weights and points (barycenter coord) on the unit triangle
    qwts, qpts = quad_triangle( k, 1.0 )
    # 
    # Compute all weights and points (coords) on the polygon
    # 
    # - number of points on each sub triangle
    n_per_tri = qwts.shape[0]
    weights = np.zeros(nt * n_per_tri, dtype=np.float64)
    points = np.zeros((nt * n_per_tri, 2), dtype=np.float64)

    # - store wts and pts from first triangle
    weights[:n_per_tri] = tri_area * qwts
    # points[:n_per_tri,:] = qpts @ tri  # np.dot
    # points[:n_per_tri,:] = np.dot(qpts, tri)  # np.dot
    # points[:n_per_tri,:] = tl._mat_mat(qpts, tri) # my mat_mat
    points[:n_per_tri,:] = tl.mat_mat(qpts, tri) # my mat_mat

    # - store reminder wts and pts
    for i in range(nt-1):
        tri[1:,:] = coords[i:i+2,:]
        tri_area = tl.area_triangle(tri)

        ss = (i+1)*n_per_tri
        tt = ss + n_per_tri
        weights[ss:tt] = tri_area * qwts
        # points[ss:tt,:] = qpts @ tri  # @
        # points[ss:tt,:] = qpts.dot( tri ) # dot
        points[ss:tt,:] = tl.mat_mat(qpts, tri) # tl.mat_mat

    return weights, points




def test_quad_1d():
    import sympy
    from sympy.abc import x
    import math

    # f = x**4+x**2+sympy.exp(x)+sympy.cos(5*x)
    d = 6
    f = x**d + 2*x**(d-1)
    int_f = sympy.integrate(f,(x, -2./3, 2./3))
    print('Exact integral is: ', int_f.evalf(16))

    # qwts, qpts = quad_1d_Gauss_Lobatto(d, -2./3, 2./3)
    qwts, qpts = quad_1d(d, -2./3, 2./3)
    print(qwts, qpts)
    

    # I = qwts*(qpts**4+qpts**2+np.exp(qpts)+np.cos(5*qpts))
    I = qwts*(qpts**d+2*qpts**(d-1))
    print( 'Error between exact integral and quadrature is: ',\
        np.sum(I)-int_f.evalf(16) )


def test_quad_triangle():
    from sympy.abc import x, y
    from sympy.geometry.polygon import Polygon
    from sympy.integrals.intpoly import polytope_integrate

    k=17
    # Define the function to be making quadrature
    def polyn (x,y):
        return x**k + y**k+ x*y

    # Define triangle
    coords = np.array([[0., 0.],[1.0, 0.0], [0.0, 1.0]])

    # Extract x in a, and y in b
    a,b = coords[:,0], coords[:,1]
    # Compute exact integral by sympy
    I1 = - polytope_integrate(Polygon((a[0], b[0]), (a[1], b[1]), (a[2], b[2])),\
        x**k + y**k + x*y)
    print('Exact integral is: ', I1, I1.evalf(15))

    # Quadrature weights and points in barycentric coords
    qwts, qpts = quad_triangle(k, tl.area_triangle(coords))
    print('quad:', qwts, '\n', qpts)
    print('k=', k)

    # physical quadrature points
    xy = qpts.dot( coords ) #tl.mat_mat(qpts, coords)
    # Numerical integral
    I2 = np.sum( qwts * polyn(xy[:,0], xy[:,1]))
    print('Numerical integral is: ', I2)

    # Error
    print('Error between exact integral and quadrature is: ', I2-I1.evalf(15))




def test_quad_subtriangle():
    '''Date: Jun 4, 2020
    '''
    from sympy.abc import x, y
    from sympy.geometry.polygon import Polygon
    from sympy.integrals.intpoly import polytope_integrate

    # Define interant
    def polyn (x,y):
        return -x**2 + x*y**1 + y**2

    # define a polygon 
    # coords = np.array([[0.0, 0.0],[1.0, 0.],[1., 1.],[0., 1.]],dtype=np.float)
    coords = np.array([[0.0, 0.0],[1.0, 0.],[1., 1.],[0., 1.], [-1,.5]],dtype=np.float)
    
    # Compute exact integral by sympy
    # 
    # extract x in a, and y in b
    a,b = coords[:,0], coords[:,1]
    I1 = - polytope_integrate(Polygon((a[0], b[0]), (a[1], b[1]), (a[2], b[2]),\
        (a[3], b[3]), (a[4], b[4])),  -x**2 + x*y**1 + y**2)

    # Compute numerical integral
    # 
    k = 2
    coord_center = np.array([.5,.5], dtype=np.float)

    qwts, qpts = quad_subtriangle(k, coords, coord_center)
    # pts = qpts * coords
    print(qwts, '\n', qpts)

    I2 = np.sum(qwts*polyn(qpts[:,0], qpts[:,1]))


    print('Exact integral is: ', I1, I1.evalf(15))
    print('Quadrature: ', I2)







if __name__ == "__main__":
    # main()
    # import matplotlib.pyplot as plt
    # # test_quad_1d()
    # n = 15
    # dt = 1.0/n/2
    # for i in range(0,n,2):
    #     wts, pts = quad_1d(i)
    #     plt.plot(pts, (n-i)/n*np.ones(pts.shape[0]),'*')
    # plt.title("Gauss-Legendre Quadrature Rule")
    # plt.show()

    # test_quad_1d()
    # qwts, qpts = quad_1d_Gauss_Lobatto(k=2, a=-1, b=1)
    # print(qwts, qpts)

    test_quad_triangle()
    # test_quad_subtriangle()

    # start = time.time()
    # test()
    # end = time.time()
    # print(end-start)

    # # test for TriangleQuadrature
    # from sympy.integrals.intpoly import *
    # import numpy as np
    # test_TriangleQuadrature()

    # x = np.array([1.0, 0.0, -1.0, 0.0])
    # y = np.array([0.0, 1.0, 0.0, -1.0])
    # rho, phi = cart2pol(x, y)
    # for i in range(0,rho.shape[0]):
    #     if phi[i] < 0:
    #         phi[i] += 2*np.pi
    # print(rho, phi)